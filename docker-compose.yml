version: '2'
services:
  percona:
    image: ${REGISTRY_HOST}:5000/percona:${PERCONA_IMAGE_VERSION}
    environment:
      - "MYSQL_ROOT_PASSWORD=${MYSQL_PASSWORD}"
      - "DISCOVERY_SERVICE=${ETCD_HOST}"
      - "CLUSTER_NAME=${CLUSTER_NAME}"
      - "DATABASES_NETWORK_NAME=${DATABASES_NETWORK_NAME}"
      - "affinity:container!=*percona*"
    volumes:
      - /data/percona:/var/lib/mysql
    networks:
      - database
      - proxies_middleware
    restart: always
    logging:
      driver: gelf
      options:
        gelf-address: "udp://${LOGGING_HOST}"
networks:
  database:
    driver: overlay
  proxies_middleware:
    external: true
